@page "/"
@using TaskManagementWeb.Services
@inject AuthService Auth
@inject NavigationManager Nav

@if (!initialized)
{
    <p class="text-muted text-center mt-4">Checking authentication...</p>
}
else if (!Auth.IsAuthenticated)
{
    <div class="text-center py-5">
        <h1 class="page-title">Welcome to Task Manager</h1>
        <p class="lead">Please log in to view your dashboard or register to get started.</p>
        <button class="btn btn-primary me-2" @onclick='() => Nav.NavigateTo("/login")'>Login</button>
        <button class="btn btn-outline-secondary" @onclick='() => Nav.NavigateTo("/register")'>Register</button>
    </div>
}

@code {
    private bool initialized = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        await Auth.InitializeAsync();

        if (Auth.IsAuthenticated)
        {
            Nav.NavigateTo("/projects", true);
            return;
        }

        initialized = true;
        StateHasChanged();
    }
}