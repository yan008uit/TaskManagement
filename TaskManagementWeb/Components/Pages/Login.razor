@page "/login"
@using TaskManagementWeb.Services
@inject AuthService AuthService
@inject NavigationManager Nav

<div class="login-container">
    <div class="card login-card shadow-sm p-4">
        <h3 class="text-center mb-4">Login</h3>

        @if (!string.IsNullOrEmpty(Error))
        {
            <div class="alert alert-danger">@Error</div>
        }

        <div class="form-floating mb-3">
            <input @bind="Username" type="text" class="form-control" id="floatingUsername" placeholder="Username" />
            <label for="floatingUsername">Username</label>
        </div>
        <div class="form-floating mb-3">
            <input @bind="Password" type="password" class="form-control" id="floatingPassword" placeholder="Password" />
            <label for="floatingPassword">Password</label>
        </div>

        <button class="btn btn-primary w-100 btn-lg" @onclick="HandleLogin">
            Login
        </button>
    </div>
</div>

@code {
    private string Username = "";
    private string Password = "";
    private string? Error;

    private async Task HandleLogin()
    {
        Error = null;

        var token = await AuthService.Login(Username, Password);

        if (token != null)
        {
            await Task.Delay(100);
            Nav.NavigateTo("/projects", forceLoad: true);
        }
        else
        {
            Error = "Invalid username or password.";
        }

    }
}